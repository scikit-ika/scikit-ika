
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Tutorials &#8212; scikit-ika  documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="index.html">
  <img src="_static/ika-logo.svg" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="documentation.html">
  API Documentation
 </a>
</li>

    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://scikit-ika.github.io/">Home<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/scikit-ika/scikit-ika" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tutorial-1-predicting-forest-cover-type-using-pearl">
   Tutorial 1: Predicting Forest Cover Type using PEARL
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tutorial-2-error-rate-comparison-between-autoddm-and-ddm-on-synthetic-data-stream">
   Tutorial 2: Error rate comparison between AutoDDM and DDM on synthetic data stream
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tutorial-3-predicting-forest-cover-type-using-nacre">
   Tutorial 3: Predicting Forest Cover Type using NACRE
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tutorial-4-transfer-learning-with-aotradaboost">
   Tutorial 4: Transfer Learning with AOTrAdaBoost
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tutorial-5-transfer-learning-with-opera">
   Tutorial 5: Transfer Learning with OPERA
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="tutorials">
<h1>Tutorials<a class="headerlink" href="#tutorials" title="Permalink to this headline">#</a></h1>
<section id="tutorial-1-predicting-forest-cover-type-using-pearl">
<h2>Tutorial 1: Predicting Forest Cover Type using PEARL<a class="headerlink" href="#tutorial-1-predicting-forest-cover-type-using-pearl" title="Permalink to this headline">#</a></h2>
<p>Dataset Information:</p>
<ul class="simple">
<li><p>Forest cover type is natural resource inventory information often economically or legally impossible to collect. Vital to any private, state, or federal land management agency.</p></li>
<li><p>Collected from four wilderness areas located in the Roosevelt National Forest of northern Colorado.</p></li>
<li><p>Contains variables such as wilderness areas and soil type.</p></li>
<li><p>Available under the <a class="reference external" href="https://github.com/scikit-ika/recurrent-data/tree/master/real-world">recurrent-data repo</a>.</p></li>
</ul>
<p>Code</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">notebook</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">animation</span>
<span class="kn">from</span> <span class="nn">skika.ensemble</span> <span class="kn">import</span> <span class="n">adaptive_random_forest</span><span class="p">,</span> <span class="n">pearl</span>


<span class="k">class</span> <span class="nc">evaluate</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classifier</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_instances</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classifier</span> <span class="o">=</span> <span class="n">classifier</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">classifier</span><span class="o">.</span><span class="n">init_data_source</span><span class="p">(</span><span class="s2">&quot;/your/path/recurrent-data/real-world/covtype.arff&quot;</span><span class="p">);</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">sample_freq</span> <span class="o">=</span> <span class="mi">1000</span>

        <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sample_freq</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier</span><span class="o">.</span><span class="n">get_next_instance</span><span class="p">():</span>
                <span class="k">break</span>

            <span class="c1"># test</span>
            <span class="n">prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>

            <span class="n">actual_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier</span><span class="o">.</span><span class="n">get_cur_instance_label</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">prediction</span> <span class="o">==</span> <span class="n">actual_label</span><span class="p">:</span>
                <span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># train</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">classifier</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">classifier</span><span class="o">.</span><span class="n">delete_cur_instance</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy</span> <span class="o">=</span> <span class="n">correct</span> <span class="o">/</span> <span class="n">sample_freq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_instances</span> <span class="o">+=</span> <span class="mi">1000</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_instances</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">accuracy</span>

<span class="n">num_trees</span> <span class="o">=</span> <span class="mi">60</span>
<span class="n">max_num_candidate_trees</span> <span class="o">=</span> <span class="mi">120</span>
<span class="n">repo_size</span> <span class="o">=</span> <span class="mi">9000</span>
<span class="n">edit_distance_threshold</span> <span class="o">=</span> <span class="mi">90</span>
<span class="n">kappa_window</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">lossy_window_size</span> <span class="o">=</span> <span class="mi">100000000</span>
<span class="n">reuse_window_size</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">max_features</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">bg_kappa_threshold</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">cd_kappa_threshold</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">reuse_rate_upper_bound</span> <span class="o">=</span> <span class="mf">0.18</span>
<span class="n">warning_delta</span> <span class="o">=</span> <span class="mf">0.0001</span>
<span class="n">drift_delta</span> <span class="o">=</span> <span class="mf">0.00001</span>
<span class="n">enable_state_adaption</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">enable_state_graph</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">arf_classifier</span> <span class="o">=</span> <span class="n">adaptive_random_forest</span><span class="p">(</span><span class="n">num_trees</span><span class="p">,</span>
                                        <span class="n">max_features</span><span class="p">,</span>
                                        <span class="n">warning_delta</span><span class="p">,</span>
                                        <span class="n">drift_delta</span><span class="p">)</span>
<span class="n">arf</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">arf_classifier</span><span class="p">)</span>

<span class="n">pearl_classifier</span> <span class="o">=</span> <span class="n">pearl</span><span class="p">(</span><span class="n">num_trees</span><span class="p">,</span>
                         <span class="n">max_num_candidate_trees</span><span class="p">,</span>
                         <span class="n">repo_size</span><span class="p">,</span>
                         <span class="n">edit_distance_threshold</span><span class="p">,</span>
                         <span class="n">kappa_window</span><span class="p">,</span>
                         <span class="n">lossy_window_size</span><span class="p">,</span>
                         <span class="n">reuse_window_size</span><span class="p">,</span>
                         <span class="n">max_features</span><span class="p">,</span>
                         <span class="n">bg_kappa_threshold</span><span class="p">,</span>
                         <span class="n">cd_kappa_threshold</span><span class="p">,</span>
                        <span class="n">reuse_rate_upper_bound</span><span class="p">,</span>
                         <span class="n">warning_delta</span><span class="p">,</span>
                         <span class="n">drift_delta</span><span class="p">,</span>
                         <span class="n">enable_state_adaption</span><span class="p">,</span>
                         <span class="n">enable_state_graph</span><span class="p">)</span>
<span class="n">pearl</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">pearl_classifier</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="n">x_arf</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">y_arf</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">x_pearl</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">y_pearl</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">max_samples</span> <span class="o">=</span> <span class="mi">580000</span>

<span class="k">def</span> <span class="nf">frames_arf</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_samples</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">arf</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">animate_arf</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="n">x_arf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y_arf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_arf</span><span class="p">,</span> <span class="n">y_arf</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ARF&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">frames_pearl</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_samples</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">pearl</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">animate_pearl</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="n">x_pearl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y_pearl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_pearl</span><span class="p">,</span> <span class="n">y_pearl</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;PEARL&#39;</span><span class="p">)</span>

<span class="n">anim_arf</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">animate_arf</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="n">frames_arf</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">anim_pearl</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">animate_pearl</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="n">frames_pearl</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;no. instances&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>

<span class="n">F</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
<span class="n">Size</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
<span class="n">F</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span><span class="p">,</span> <span class="n">forward</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Result:</p>
<img alt="_images/covtype-results.svg" src="_images/covtype-results.svg" /></section>
<section id="tutorial-2-error-rate-comparison-between-autoddm-and-ddm-on-synthetic-data-stream">
<h2>Tutorial 2: Error rate comparison between AutoDDM and DDM on synthetic data stream<a class="headerlink" href="#tutorial-2-error-rate-comparison-between-autoddm-and-ddm-on-synthetic-data-stream" title="Permalink to this headline">#</a></h2>
<p>Dataset Information:</p>
<ul class="simple">
<li><p>AGRAWAL data stream generator.</p></li>
</ul>
<p>Code</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skika.hyper_parameter_tuning.drift_detectors</span> <span class="kn">import</span> <span class="n">AutoDDM</span>
<span class="kn">from</span> <span class="nn">skmultiflow.drift_detection</span> <span class="kn">import</span> <span class="n">DDM</span>
<span class="kn">from</span> <span class="nn">skika.data.reccurring_concept_stream</span> <span class="kn">import</span> <span class="n">RCStreamType</span><span class="p">,</span> <span class="n">RecurringConceptStream</span><span class="p">,</span> <span class="n">conceptOccurence</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">from</span> <span class="nn">skmultiflow.trees</span> <span class="kn">import</span> <span class="n">HoeffdingTreeClassifier</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;seaborn-whitegrid&quot;</span><span class="p">)</span>

<span class="c1"># Global variable</span>
<span class="n">TRAINING_SIZE</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">STREAM_SIZE</span> <span class="o">=</span> <span class="mi">6000000</span>
<span class="n">grace</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">tolerance</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">DRIFT_INTERVALS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50000</span><span class="p">]</span>
<span class="n">concepts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">RANDOMNESS</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">seed</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
<span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">actuals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">concept_chain</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="n">current_concept</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">STREAM_SIZE</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">DRIFT_INTERVALS</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
               <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">randomness</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">RANDOMNESS</span><span class="p">)</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="p">((</span><span class="n">randomness</span> <span class="o">*</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="n">randomness</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">concept_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">concepts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">concepts</span><span class="p">[</span><span class="n">concept_index</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_concept</span><span class="p">:</span>
                    <span class="n">concept_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">concepts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">concept</span> <span class="o">=</span> <span class="n">concepts</span><span class="p">[</span><span class="n">concept_index</span><span class="p">]</span>
                <span class="n">concept_chain</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">concept</span>
                <span class="n">actuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="n">current_concept</span> <span class="o">=</span> <span class="n">concept</span>

                <span class="n">i2</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">17000</span>
                <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i2</span><span class="p">)</span>
                <span class="n">randomness</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">RANDOMNESS</span><span class="p">)</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">i2</span> <span class="o">+</span> <span class="p">((</span><span class="n">randomness</span> <span class="o">*</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="n">randomness</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">concept_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">concepts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">concepts</span><span class="p">[</span><span class="n">concept_index</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_concept</span><span class="p">:</span>
                    <span class="n">concept_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">concepts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">concept</span> <span class="o">=</span> <span class="n">concepts</span><span class="p">[</span><span class="n">concept_index</span><span class="p">]</span>
                <span class="n">concept_chain</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">concept</span>
                <span class="n">actuals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="n">current_concept</span> <span class="o">=</span> <span class="n">concept</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="n">concept_chain</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">concept_0</span> <span class="o">=</span> <span class="n">conceptOccurence</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">difficulty</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                             <span class="n">appearences</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">examples_per_appearence</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">DRIFT_INTERVALS</span><span class="p">))</span>
<span class="n">concept_1</span> <span class="o">=</span> <span class="n">conceptOccurence</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">difficulty</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                             <span class="n">appearences</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">examples_per_appearence</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">DRIFT_INTERVALS</span><span class="p">))</span>
<span class="n">concept_2</span> <span class="o">=</span> <span class="n">conceptOccurence</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">difficulty</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                             <span class="n">appearences</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">examples_per_appearence</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">DRIFT_INTERVALS</span><span class="p">))</span>
<span class="n">desc</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">concept_0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">concept_1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="n">concept_2</span><span class="p">}</span>

<span class="n">datastream</span> <span class="o">=</span> <span class="n">RecurringConceptStream</span><span class="p">(</span>
    <span class="n">rctype</span><span class="o">=</span><span class="n">RCStreamType</span><span class="o">.</span><span class="n">AGRAWAL</span><span class="p">,</span>
    <span class="n">num_samples</span><span class="o">=</span><span class="n">STREAM_SIZE</span><span class="p">,</span>
    <span class="n">noise</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">concept_chain</span><span class="o">=</span><span class="n">concept_chain</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
    <span class="n">desc</span><span class="o">=</span><span class="n">desc</span><span class="p">,</span>
    <span class="n">boost_first_occurance</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">TRAINING_SIZE</span><span class="p">):</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">datastream</span><span class="o">.</span><span class="n">next_sample</span><span class="p">()</span>
    <span class="n">X_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>

<span class="n">ht_auto</span> <span class="o">=</span> <span class="n">HoeffdingTreeClassifier</span><span class="p">()</span>
<span class="n">ht_auto</span><span class="o">.</span><span class="n">partial_fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">ht_ddm</span> <span class="o">=</span> <span class="n">HoeffdingTreeClassifier</span><span class="p">()</span>
<span class="n">ht_ddm</span><span class="o">.</span><span class="n">partial_fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">n_global</span> <span class="o">=</span> <span class="n">TRAINING_SIZE</span>  <span class="c1"># Cumulative Number of observations</span>
<span class="n">d_auto</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">d_ddm</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">TP_auto</span><span class="o">=</span> <span class="p">[]</span>
<span class="n">TP_ddm</span><span class="o">=</span> <span class="p">[]</span>
<span class="n">FP_auto</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">FP_ddm</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Delay_auto</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Delay_ddm</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">grace_end_auto</span> <span class="o">=</span> <span class="n">n_global</span>
<span class="n">grace_end_ddm</span> <span class="o">=</span> <span class="n">n_global</span>
<span class="n">accuracy_auto</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">accuracy_ddm</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">acc_x</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">acc_y_auto</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">acc_y_ddm</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">ddm</span> <span class="o">=</span> <span class="n">DDM</span><span class="p">()</span>
<span class="n">autoDDM</span> <span class="o">=</span> <span class="n">AutoDDM</span><span class="p">(</span><span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">)</span>
<span class="k">while</span> <span class="n">datastream</span><span class="o">.</span><span class="n">has_more_samples</span><span class="p">():</span>
    <span class="n">n_global</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">datastream</span><span class="o">.</span><span class="n">next_sample</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">n_global</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">acc_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_global</span><span class="p">)</span>
        <span class="n">acc_y_auto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">accuracy_auto</span> <span class="o">/</span> <span class="n">n_global</span><span class="p">))</span>
        <span class="n">acc_y_ddm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">accuracy_ddm</span> <span class="o">/</span> <span class="n">n_global</span><span class="p">))</span>

    <span class="n">y_predict_ddm</span> <span class="o">=</span> <span class="n">ht_ddm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">ddm</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">y_test</span> <span class="o">!=</span> <span class="n">y_predict_ddm</span><span class="p">)</span>
    <span class="n">accuracy_ddm</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">y_test</span> <span class="o">==</span> <span class="n">y_predict_ddm</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n_global</span> <span class="o">&gt;</span> <span class="n">grace_end_ddm</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ddm</span><span class="o">.</span><span class="n">detected_change</span><span class="p">():</span>
            <span class="n">d_ddm</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">drift_point_ddm</span> <span class="o">=</span> <span class="n">key</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">actuals</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">n_global</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">drift_point_ddm</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">drift_point_ddm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TP_ddm</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">drift_point_ddm</span> <span class="o">-</span> <span class="n">n_global</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span><span class="p">):</span>
                <span class="n">Delay_ddm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">n_global</span> <span class="o">-</span> <span class="n">drift_point_ddm</span><span class="p">))</span>
                <span class="n">TP_ddm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">drift_point_ddm</span><span class="p">)</span>
                <span class="n">ht_ddm</span> <span class="o">=</span> <span class="n">HoeffdingTreeClassifier</span><span class="p">()</span>
                <span class="n">grace_end_ddm</span> <span class="o">=</span> <span class="n">n_global</span> <span class="o">+</span> <span class="n">grace</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">FP_ddm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">drift_point_ddm</span><span class="p">)</span>
    <span class="n">ht_ddm</span><span class="o">.</span><span class="n">partial_fit</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>

    <span class="n">y_predict_auto</span> <span class="o">=</span> <span class="n">ht_auto</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">autoDDM</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">y_test</span> <span class="o">!=</span> <span class="n">y_predict_auto</span><span class="p">,</span> <span class="n">n_global</span><span class="p">)</span>
    <span class="n">accuracy_auto</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">y_test</span> <span class="o">==</span> <span class="n">y_predict_auto</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n_global</span> <span class="o">&gt;</span> <span class="n">grace_end_auto</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">autoDDM</span><span class="o">.</span><span class="n">detected_change</span><span class="p">():</span>
            <span class="n">d_auto</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">drift_point_auto</span> <span class="o">=</span> <span class="n">key</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">actuals</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">n_global</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">drift_point_auto</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">drift_point_auto</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TP_auto</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">drift_point_auto</span> <span class="o">-</span> <span class="n">n_global</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span><span class="p">):</span>
                <span class="n">Delay_auto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">n_global</span> <span class="o">-</span> <span class="n">drift_point_auto</span><span class="p">))</span>
                <span class="n">TP_auto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">drift_point_auto</span><span class="p">)</span>
                <span class="n">ht_auto</span> <span class="o">=</span> <span class="n">HoeffdingTreeClassifier</span><span class="p">()</span>
                <span class="n">autoDDM</span><span class="o">.</span><span class="n">detect_TP</span><span class="p">(</span><span class="n">n_global</span><span class="p">)</span>
                <span class="n">grace_end_auto</span> <span class="o">=</span> <span class="n">n_global</span> <span class="o">+</span> <span class="n">grace</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">autoDDM</span><span class="o">.</span><span class="n">detect_FP</span><span class="p">(</span><span class="n">n_global</span><span class="p">)</span>
                <span class="n">FP_auto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">drift_point_auto</span><span class="p">)</span>
    <span class="n">ht_auto</span><span class="o">.</span><span class="n">partial_fit</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Actual drifts:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">actuals</span><span class="p">)))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of drifts detected by AutoDDM: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">d_auto</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TP by AutoDDM:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TP_auto</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FP by AutoDDM:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">FP_auto</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean Delay by AutoDDM:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Delay_auto</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy by AutoDDM:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">accuracy_auto</span> <span class="o">/</span> <span class="n">STREAM_SIZE</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of drifts detected by DDM: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">d_ddm</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TP by DDM:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TP_ddm</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FP by DDM:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">FP_ddm</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean Delay by DDM:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Delay_ddm</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy by DDM:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">accuracy_ddm</span> <span class="o">/</span> <span class="n">STREAM_SIZE</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">acc_x</span><span class="p">,</span> <span class="n">acc_y_ddm</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ddm&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">acc_x</span><span class="p">,</span> <span class="n">acc_y_auto</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;autoDDM&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Error Rate&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Result:</p>
<img alt="_images/ErrorRate.PNG" src="_images/ErrorRate.PNG" />
</section>
<section id="tutorial-3-predicting-forest-cover-type-using-nacre">
<h2>Tutorial 3: Predicting Forest Cover Type using NACRE<a class="headerlink" href="#tutorial-3-predicting-forest-cover-type-using-nacre" title="Permalink to this headline">#</a></h2>
<p>Dataset Information:</p>
<ul class="simple">
<li><p>Same as Tutorial 1</p></li>
</ul>
<p>Additional Instructions</p>
<ul class="simple">
<li><p>NACRE requires an additional sequence predictor service.</p></li>
<li><p>The sequence predictor module is available at the <a class="reference external" href="https://github.com/scikit-ika/sequence-prediction-service">sequence-prediction-service repo</a>.</p></li>
</ul>
<p>Code</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randrange</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">cohen_kappa_score</span>
<span class="kn">from</span> <span class="nn">skika.nacre</span> <span class="kn">import</span> <span class="n">nacre_wrapper</span>

<span class="c1"># classification settings</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">stream_file_path</span> <span class="o">=</span> <span class="s2">&quot;./recurrent-data/real-world/covtype.arff&quot;</span>
<span class="n">sample_freq</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># pearl specific params</span>
<span class="n">num_trees</span> <span class="o">=</span> <span class="mi">60</span>
<span class="n">max_num_candidate_trees</span> <span class="o">=</span> <span class="mi">120</span>
<span class="n">repo_size</span> <span class="o">=</span> <span class="mi">9000</span>
<span class="n">edit_distance_threshold</span> <span class="o">=</span> <span class="mi">90</span>
<span class="n">kappa_window</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">lossy_window_size</span> <span class="o">=</span> <span class="mi">100000000</span>
<span class="n">reuse_window_size</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">max_features</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">bg_kappa_threshold</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">cd_kappa_threshold</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">reuse_rate_upper_bound</span> <span class="o">=</span> <span class="mf">0.18</span>
<span class="n">warning_delta</span> <span class="o">=</span> <span class="mf">0.0001</span>
<span class="n">drift_delta</span> <span class="o">=</span> <span class="mf">0.00001</span>

<span class="n">poisson_lambda</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">random_state</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># nacre specific params</span>
<span class="n">grpc_port</span> <span class="o">=</span> <span class="mi">50051</span> <span class="c1"># port number for the sequence prediction grpc service</span>
<span class="n">pro_drift_window</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># number of instances must be seen for proactive drift adaptation</span>
<span class="n">seq_len</span> <span class="o">=</span> <span class="mi">8</span> <span class="c1"># sequence length for sequence predictor</span>
<span class="n">backtrack_window</span> <span class="o">=</span> <span class="mi">25</span> <span class="c1"># number of instances per eval when backtracking</span>
<span class="n">stability_delta</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">hybrid_delta</span> <span class="o">=</span> <span class="mf">0.001</span>

<span class="n">classifier</span> <span class="o">=</span> <span class="n">nacre_wrapper</span><span class="o">.</span><span class="n">nacre_wrapper</span><span class="p">(</span>
                 <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">stream_file_path</span><span class="o">=</span><span class="s2">&quot;/your/path/covtype.arff&quot;</span><span class="p">,</span>
                 <span class="n">num_trees</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
                 <span class="n">max_num_candidate_trees</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span>
                 <span class="n">repo_size</span><span class="o">=</span><span class="mi">9000</span><span class="p">,</span>
                 <span class="n">edit_distance_threshold</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                 <span class="n">kappa_window</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                 <span class="n">lossy_window_size</span><span class="o">=</span><span class="mi">100000000</span><span class="p">,</span>
                 <span class="n">reuse_window_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">max_features</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">bg_kappa_threshold</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">cd_kappa_threshold</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
                 <span class="n">reuse_rate_upper_bound</span><span class="o">=</span><span class="mf">0.18</span><span class="p">,</span>
                 <span class="n">warning_delta</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span>
                 <span class="n">drift_delta</span><span class="o">=</span><span class="mf">0.00001</span><span class="p">,</span>
                 <span class="n">poisson_lambda</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                 <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">pro_drift_window</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                 <span class="n">backtrack_window</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
                 <span class="n">stability_delta</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
                 <span class="n">hybrid_delta</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
                 <span class="n">seq_len</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>


<span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">window_actual_labels</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">window_predicted_labels</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">process_time</span><span class="p">()</span>

<span class="k">while</span> <span class="n">classifier</span><span class="o">.</span><span class="n">get_next_instance</span><span class="p">():</span>

    <span class="c1"># test</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>

    <span class="n">actual_label</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">get_cur_instance_label</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">prediction</span> <span class="o">==</span> <span class="n">actual_label</span><span class="p">:</span>
        <span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">window_actual_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">actual_label</span><span class="p">)</span>
    <span class="n">window_predicted_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>

    <span class="n">classifier</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

    <span class="c1"># log performance</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">%</span> <span class="n">sample_freq</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">accuracy</span> <span class="o">=</span> <span class="n">correct</span> <span class="o">/</span> <span class="n">sample_freq</span>
        <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">process_time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">+</span> <span class="n">classifier</span><span class="o">.</span><span class="n">cpt_runtime</span>
        <span class="n">kappa</span> <span class="o">=</span> <span class="n">cohen_kappa_score</span><span class="p">(</span><span class="n">window_actual_labels</span><span class="p">,</span> <span class="n">window_predicted_labels</span><span class="p">)</span>
        <span class="n">candidate_tree_size</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">get_candidate_tree_group_size</span><span class="p">()</span>
        <span class="n">tree_pool_size</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">get_tree_pool_size</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">accuracy</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">kappa</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">candidate_tree_size</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">tree_pool_size</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">elapsed_time</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">window_actual_labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">window_predicted_labels</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
</section>
<section id="tutorial-4-transfer-learning-with-aotradaboost">
<h2>Tutorial 4: Transfer Learning with AOTrAdaBoost<a class="headerlink" href="#tutorial-4-transfer-learning-with-aotradaboost" title="Permalink to this headline">#</a></h2>
<p>Dataset Information:</p>
<ul class="simple">
<li><p>The bike datasets are real-world datasets available at the <a class="reference external" href="https://github.com/scikit-ika/transfer-data/tree/main/bike">transfer-data repo</a>.</p></li>
<li><p>The task is to classify whether rental bikes are in low or high demand at different times in different cities. We use the configuration of weekdays from Washington D.C. as the source and weekends in London as the target, whereby both source and target datasets contain concept drifts.</p></li>
</ul>
<p>Code</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skika.aotradaboost</span> <span class="kn">import</span> <span class="n">trans_tree_wrapper</span>

<span class="n">sample_freq</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">num_trees</span> <span class="o">=</span> <span class="mi">60</span>
<span class="n">rf_lambda</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">random_state</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">warning_delta</span> <span class="o">=</span> <span class="mf">0.0001</span>
<span class="n">drift_delta</span> <span class="o">=</span> <span class="mf">0.00001</span>
<span class="n">kappa_window</span> <span class="o">=</span> <span class="mi">60</span>

<span class="n">least_transfer_warning_period_instances_length</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">instance_store_size</span> <span class="o">=</span> <span class="mi">8000</span>
<span class="n">num_diff_distr_instances</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">bbt_pool_size</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">eviction_interval</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="n">transfer_kappa_threshold</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">transfer_gamma</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">transfer_match_lowerbound</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">boost_mode</span> <span class="o">=</span> <span class="s2">&quot;atradaboost&quot;</span> <span class="c1"># i.e. aotradaboost</span>
<span class="n">disable_drift_detection</span> <span class="o">=</span> <span class="kc">False</span>


<span class="n">data_file_path</span> <span class="o">=</span> <span class="s2">&quot;/your/path/transfer-data/bike/dc-weekend-source.arff;/your/path/transfer-data/bike/weekday.arff&quot;</span><span class="p">;</span>

<span class="n">classifier</span> <span class="o">=</span> <span class="n">trans_tree_wrapper</span><span class="p">(</span>
    <span class="nb">len</span><span class="p">(</span><span class="n">data_file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)),</span>
    <span class="n">random_state</span><span class="p">,</span>
    <span class="n">kappa_window</span><span class="p">,</span>
    <span class="n">warning_delta</span><span class="p">,</span>
    <span class="n">drift_delta</span><span class="p">,</span>
    <span class="n">least_transfer_warning_period_instances_length</span><span class="p">,</span>
    <span class="n">instance_store_size</span><span class="p">,</span>
    <span class="n">num_diff_distr_instances</span><span class="p">,</span>
    <span class="n">bbt_pool_size</span><span class="p">,</span>
    <span class="n">eviction_interval</span><span class="p">,</span>
    <span class="n">transfer_kappa_threshold</span><span class="p">,</span>
    <span class="n">transfer_gamma</span><span class="p">,</span>
    <span class="n">transfer_match_lowerbound</span><span class="p">,</span>
    <span class="n">boost_mode</span><span class="p">,</span>
    <span class="n">num_trees</span><span class="p">,</span>
    <span class="n">disable_drift_detection</span><span class="p">)</span>

<span class="n">data_file_list</span> <span class="o">=</span> <span class="n">data_file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>


<span class="n">prequential_evaluation_transfer</span><span class="p">(</span>
    <span class="n">classifier</span><span class="o">=</span><span class="n">classifier</span><span class="p">,</span>
    <span class="n">data_file_paths</span><span class="o">=</span><span class="n">data_file_list</span><span class="p">,</span>
    <span class="n">sample_freq</span><span class="o">=</span><span class="n">sample_freq</span><span class="p">,</span>
    <span class="n">expected_accuracies</span><span class="o">=</span><span class="n">expected_accuracies</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ClassifierMetrics</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance_idx</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">prequential_evaluation_transfer</span><span class="p">(</span>
        <span class="n">classifier</span><span class="p">,</span>
        <span class="n">data_file_paths</span><span class="p">,</span>
        <span class="n">sample_freq</span><span class="p">,</span>
        <span class="n">expected_accuracies</span><span class="p">):</span>

    <span class="n">classifier_metrics_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_file_paths</span><span class="p">)):</span>
        <span class="n">classifier</span><span class="o">.</span><span class="n">init_data_source</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">data_file_paths</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">classifier_metrics_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ClassifierMetrics</span><span class="p">())</span>

    <span class="n">classifier_idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">classifier</span><span class="o">.</span><span class="n">switch_classifier</span><span class="p">(</span><span class="n">classifier_idx</span><span class="p">)</span>
    <span class="n">metric</span> <span class="o">=</span> <span class="n">classifier_metrics_list</span><span class="p">[</span><span class="n">classifier_idx</span><span class="p">]</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">classifier</span><span class="o">.</span><span class="n">get_next_instance</span><span class="p">():</span>
            <span class="c1"># Switch streams to simulate parallel streams</span>

            <span class="n">classifier_idx</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">classifier_idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_file_paths</span><span class="p">):</span>
                <span class="k">break</span>

            <span class="n">classifier</span><span class="o">.</span><span class="n">switch_classifier</span><span class="p">(</span><span class="n">classifier_idx</span><span class="p">)</span>
            <span class="n">metric</span> <span class="o">=</span> <span class="n">classifier_metrics_list</span><span class="p">[</span><span class="n">classifier_idx</span><span class="p">]</span>

            <span class="nb">print</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;switching to classifier_idx </span><span class="si">{</span><span class="n">classifier_idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">classifier_metrics_list</span><span class="p">[</span><span class="n">classifier_idx</span><span class="p">]</span><span class="o">.</span><span class="n">instance_idx</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># test</span>
        <span class="n">prediction</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>

        <span class="n">actual_label</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">get_cur_instance_label</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">prediction</span> <span class="o">==</span> <span class="n">actual_label</span><span class="p">:</span>
            <span class="n">metric</span><span class="o">.</span><span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># train</span>
        <span class="n">classifier</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

        <span class="n">log_metrics</span><span class="p">(</span>
            <span class="n">classifier_metrics_list</span><span class="p">[</span><span class="n">classifier_idx</span><span class="p">]</span><span class="o">.</span><span class="n">instance_idx</span><span class="p">,</span>
            <span class="n">sample_freq</span><span class="p">,</span>
            <span class="n">metric</span><span class="p">,</span>
            <span class="n">classifier</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">log_metrics</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">sample_freq</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">classifier</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">%</span> <span class="n">sample_freq</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">accuracy</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">metric</span><span class="o">.</span><span class="n">correct</span> <span class="o">/</span> <span class="n">sample_freq</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">accuracy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">metric</span><span class="o">.</span><span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</section>
<section id="tutorial-5-transfer-learning-with-opera">
<h2>Tutorial 5: Transfer Learning with OPERA<a class="headerlink" href="#tutorial-5-transfer-learning-with-opera" title="Permalink to this headline">#</a></h2>
<p>Dataset Information:</p>
<ul class="simple">
<li><p>The original Fashion MNIST datasets are used as the source stream, and the target stream is generated with varying similarities by inverting all pixel values of v% of the classes. We denote these configurations as MNIST v% or Fashion MNIST v%, where v% indicates the dissimilarity between the domains. In addition, we apply a 2 by 2 filter on both MNIST and Fashion MNIST datasets for reasonable performance outputs from the random forest base learners with limited tree models.</p></li>
<li><p>Available at the <a class="reference external" href="https://github.com/scikit-ika/transfer-data">transfer-data repo</a>.</p></li>
</ul>
<p>Code</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skika.transfer</span> <span class="kn">import</span> <span class="n">opera_wrapper</span>

<span class="n">sample_freq</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">num_trees</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">rf_lambda</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">random_state</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">num_phantom_branches</span><span class="o">=</span><span class="mi">30</span>
<span class="n">squashing_delta</span><span class="o">=</span><span class="mi">7</span>
<span class="n">obs_period</span><span class="o">=</span><span class="mi">1000</span>
<span class="n">conv_delta</span><span class="o">=</span><span class="mf">0.1</span>
<span class="n">conv_threshold</span><span class="o">=</span><span class="mf">0.15</span>
<span class="n">obs_window_size</span><span class="o">=</span><span class="mi">50</span>
<span class="n">perf_window_size</span><span class="o">=</span><span class="mi">5000</span>
<span class="n">min_obs_period</span><span class="o">=</span><span class="mi">2000</span>
<span class="n">split_range</span><span class="o">=</span><span class="mi">10</span>
<span class="n">force_disable_patching</span><span class="o">=</span><span class="kc">False</span>
<span class="n">force_enable_patching</span><span class="o">=</span><span class="kc">False</span>
<span class="n">grow_transfer_surrogate_during_obs</span><span class="o">=</span><span class="kc">False</span>


<span class="c1"># datasets separated by the semi-colons</span>
<span class="n">data_file_path</span><span class="o">=</span><span class="s2">&quot;/your/path/transfer-data/fashion-mnist/flip20/source.arff;/your/path/transfer-data/fashion-mnist/flip20/target.arff&quot;</span><span class="p">;</span>

<span class="n">classifier</span> <span class="o">=</span> <span class="n">opera_wrapper</span><span class="p">(</span>
    <span class="nb">len</span><span class="p">(</span><span class="n">data_file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)),</span>
    <span class="n">random_state</span><span class="p">,</span>
    <span class="n">num_trees</span><span class="p">,</span>
    <span class="n">rf_lambda</span><span class="p">,</span>
    <span class="n">num_phantom_branches</span><span class="p">,</span>
    <span class="n">squashing_delta</span><span class="p">,</span>
    <span class="n">obs_period</span><span class="p">,</span>
    <span class="n">conv_delta</span><span class="p">,</span>
    <span class="n">conv_threshold</span><span class="p">,</span>
    <span class="n">obs_window_size</span><span class="p">,</span>
    <span class="n">perf_window_size</span><span class="p">,</span>
    <span class="n">min_obs_period</span><span class="p">,</span>
    <span class="n">split_range</span><span class="p">,</span>
    <span class="n">grow_transfer_surrogate_during_obs</span><span class="p">,</span>
    <span class="n">force_disable_patching</span><span class="p">,</span>
    <span class="n">force_enable_patching</span><span class="p">)</span>

<span class="n">data_file_list</span> <span class="o">=</span> <span class="n">data_file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>


<span class="n">prequential_evaluation_transfer</span><span class="p">(</span>
    <span class="n">classifier</span><span class="o">=</span><span class="n">classifier</span><span class="p">,</span>
    <span class="n">data_file_paths</span><span class="o">=</span><span class="n">data_file_list</span><span class="p">,</span>
    <span class="n">max_samples</span><span class="o">=</span><span class="n">max_samples</span><span class="p">,</span>
    <span class="n">sample_freq</span><span class="o">=</span><span class="n">sample_freq</span><span class="p">,</span>
    <span class="n">expected_accuracies</span><span class="o">=</span><span class="n">expected_accuracies</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ClassifierMetrics</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance_idx</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">prequential_evaluation_transfer</span><span class="p">(</span>
    <span class="n">classifier</span><span class="p">,</span>
    <span class="n">data_file_paths</span><span class="p">,</span>
    <span class="n">max_samples</span><span class="p">,</span>
    <span class="n">sample_freq</span><span class="p">,</span>
    <span class="n">expected_accuracies</span><span class="p">):</span>

    <span class="n">classifier_metrics_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_file_paths</span><span class="p">)):</span>
        <span class="n">classifier</span><span class="o">.</span><span class="n">init_data_source</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">data_file_paths</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">classifier_metrics_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ClassifierMetrics</span><span class="p">())</span>

    <span class="n">classifier_idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">classifier</span><span class="o">.</span><span class="n">switch_classifier</span><span class="p">(</span><span class="n">classifier_idx</span><span class="p">)</span>
    <span class="n">metric</span> <span class="o">=</span> <span class="n">classifier_metrics_list</span><span class="p">[</span><span class="n">classifier_idx</span><span class="p">]</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">classifier</span><span class="o">.</span><span class="n">get_next_instance</span><span class="p">():</span>
            <span class="c1"># Switch streams to simulate parallel streams</span>

            <span class="n">classifier_idx</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">classifier_idx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_file_paths</span><span class="p">):</span>
                <span class="k">break</span>

            <span class="n">classifier</span><span class="o">.</span><span class="n">switch_classifier</span><span class="p">(</span><span class="n">classifier_idx</span><span class="p">)</span>
            <span class="n">metric</span> <span class="o">=</span> <span class="n">classifier_metrics_list</span><span class="p">[</span><span class="n">classifier_idx</span><span class="p">]</span>

            <span class="nb">print</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;switching to classifier_idx </span><span class="si">{</span><span class="n">classifier_idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">classifier_metrics_list</span><span class="p">[</span><span class="n">classifier_idx</span><span class="p">]</span><span class="o">.</span><span class="n">instance_idx</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># test</span>
        <span class="n">prediction</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>

        <span class="n">actual_label</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">get_cur_instance_label</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">prediction</span> <span class="o">==</span> <span class="n">actual_label</span><span class="p">:</span>
            <span class="n">metric</span><span class="o">.</span><span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># train</span>
        <span class="n">classifier</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

        <span class="n">log_metrics</span><span class="p">(</span>
            <span class="n">classifier_metrics_list</span><span class="p">[</span><span class="n">classifier_idx</span><span class="p">]</span><span class="o">.</span><span class="n">instance_idx</span><span class="p">,</span>
            <span class="n">sample_freq</span><span class="p">,</span>
            <span class="n">metric</span><span class="p">,</span>
            <span class="n">classifier</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">log_metrics</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">sample_freq</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">classifier</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">%</span> <span class="n">sample_freq</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">accuracy</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">metric</span><span class="o">.</span><span class="n">correct</span> <span class="o">/</span> <span class="n">sample_freq</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Phantom tree outputs</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">classifier</span><span class="o">.</span><span class="n">get_full_region_complexity</span><span class="p">())</span>
        <span class="n">e</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">classifier</span><span class="o">.</span><span class="n">get_error_region_complexity</span><span class="p">())</span>
        <span class="n">c</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">classifier</span><span class="o">.</span><span class="n">get_correct_region_complexity</span><span class="p">())</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">accuracy</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">metric</span><span class="o">.</span><span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</section>
</section>


              </div>
              
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2019, Team scikit-ika.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>